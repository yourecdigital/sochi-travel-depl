## Project Audit (2025-09-23)

### Overview
- Frontend: CRA, React 19, React Router v7, TypeScript, styled-components, axios, framer-motion, react-hook-form, react-hot-toast, Testing Library/Jest
- Backend: Node.js + Express, SQLite3, JWT, bcryptjs, multer, cors, dotenv, Telegram Bot API
- Databases: `./database.sqlite`, `./server/database.sqlite`

### Frontend Routes (React Router)
Path | Element
--- | ---
`/` | `HomePage`
`/tours` | `ToursPage`
`/hotels` | `HotelsPage`
`/foreign` | `ForeignPage`
`/cruises` | `CruisesPage`
`/services` | `ServicesPage`
`/service/:id` | `ServicePage`
`/hotel/:id` | `HotelDetailPage`
`/tour/:id` | `TourDetailPage`
`/foreign-tour/:id` | `ForeignTourDetailPage`
`/cruise/:id` | `CruiseDetailPage`
`/promotion/:id` | `PromotionDetailPage`
`/promotions` | `PromotionsPage`
`/contact` | `ContactPage`
`/privacy` | `PrivacyPage`
`/terms` | `TermsPage`
`/login` | `Login`
`/register` | `Register`
`/cart` | `Cart`
`/profile` | `Profile`
`/orders` | `Orders`
`/admin/login` | `AdminLogin`
`/admin/dashboard` | `AdminDashboard`
`/admin/user/:id` | `UserDetailPage`

Source: `src/App.tsx`

### Backend API Routes (Express)
Method | Path | Notes
--- | --- | ---
POST | `/api/register` | Create user, start with 500 bonus
POST | `/api/login` | JWT auth
GET | `/api/profile` | Auth required
GET | `/api/bonus/points` | Auth required
POST | `/api/bonus/add` | Auth required, add points
POST | `/api/bonus/deduct` | Auth required, deduct points
GET | `/api/bonus/history` | Auth required, history + current points
GET | `/api/admin/users` | Auth required (admin expected)
POST | `/api/admin/bonus/add` | Auth required
POST | `/api/admin/bonus/deduct` | Auth required
GET | `/api/admin/user/:userId/orders` | Auth required
GET | `/api/tours` | Public
GET | `/api/tours/:id` | Public
POST | `/api/tours` | Auth required
PUT | `/api/tours/:id` | Auth required
DELETE | `/api/tours/:id` | Auth required
GET | `/api/tours/categories` | Public
GET | `/api/tours/cities` | Public
GET | `/api/tours/types` | Public
GET | `/api/cart` | Auth required
POST | `/api/cart/add` | Auth required
DELETE | `/api/cart/:id` | Auth required
POST | `/api/orders` | Auth required (creates order, sends Telegram)
GET | `/api/orders` | Auth required
POST | `/api/admin/login` | Simple static admin credentials
GET | `/api/services` | Public
GET | `/api/services/:id` | Public
POST | `/api/services` | Auth required
PUT | `/api/services/:id` | Auth required
DELETE | `/api/services/:id` | Auth required
GET | `/api/hotels` | Public
GET | `/api/hotels/cities` | Public
GET | `/api/hotels/:id` | Public
POST | `/api/hotels` | Auth required
PUT | `/api/hotels/:id` | Auth required
DELETE | `/api/hotels/:id` | Auth required
GET | `/api/foreign` | Public
GET | `/api/foreign-tours` | Public
GET | `/api/foreign-tours/:id` | Public
POST | `/api/foreign` | Auth required
POST | `/api/foreign-tours` | Auth required
PUT | `/api/foreign/:id` | Auth required
PUT | `/api/foreign-tours/:id` | Auth required
DELETE | `/api/foreign/:id` | Auth required
DELETE | `/api/foreign-tours/:id` | Auth required
GET | `/api/cruises` | Public
GET | `/api/cruises/:id` | Public
POST | `/api/cruises` | Auth required
PUT | `/api/cruises/:id` | Auth required
DELETE | `/api/cruises/:id` | Auth required
GET | `/api/promotions/random` | Public, `?limit=`
GET | `/api/promotions` | Public (active, not expired)
GET | `/api/promotions/:id` | Public
POST | `/api/promotions` | Auth required
PUT | `/api/promotions/:id` | Auth required
DELETE | `/api/promotions/:id` | Auth required
DELETE | `/api/tours/category/:category` | Auth required (bulk delete)
DELETE | `/api/foreign-tours/category/:country` | Auth required (bulk delete)
DELETE | `/api/cruises/category/:category` | Auth required (bulk delete)
DELETE | `/api/promotions/category/:category` | Auth required (bulk delete)
DELETE | `/api/services/category/:category` | Auth required (bulk delete)
DELETE | `/api/hotels/category/:category` | Auth required (bulk delete)
GET | `/api/hero-backgrounds` | Public
GET | `/api/hero-backgrounds/:pageName` | Public
POST | `/api/hero-backgrounds` | Auth required (upsert)
DELETE | `/api/hero-backgrounds/:pageName` | Auth required
POST | `/api/upload` | Auth required, multer, serves `/uploads/*`

Static: `app.use('/uploads', express.static(...))`

Source: `server/index.js`

### Database Schema (inferred from server code)
- `users`
  - `id` INTEGER PK AUTOINCREMENT
  - `email` TEXT UNIQUE NOT NULL
  - `password` TEXT NOT NULL
  - `name` TEXT NOT NULL
  - `phone` TEXT
  - `bonus_points` INTEGER DEFAULT 0
  - `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP

- `tours`
  - `id` INTEGER PK AUTOINCREMENT
  - `name` TEXT NOT NULL
  - `description` TEXT
  - `price` REAL NOT NULL
  - `duration` TEXT
  - `destination` TEXT
  - `city` TEXT
  - `category` TEXT DEFAULT 'Общие туры'
  - `tour_type` TEXT
  - `image_url` TEXT
  - `available` BOOLEAN DEFAULT 1

- `hotels`
  - `id` INTEGER PK AUTOINCREMENT
  - `name` TEXT NOT NULL
  - `description` TEXT
  - `price` REAL NOT NULL
  - `location` TEXT
  - `stars` INTEGER
  - `category` TEXT DEFAULT 'Общие отели'
  - `city` TEXT
  - `image_url` TEXT
  - `available` BOOLEAN DEFAULT 1

- `foreign_tours`
  - `id` INTEGER PK AUTOINCREMENT
  - `name` TEXT NOT NULL
  - `description` TEXT
  - `price` REAL NOT NULL
  - `country` TEXT
  - `duration` TEXT
  - `highlights` TEXT (JSON)
  - `tour_type` TEXT
  - `category` TEXT DEFAULT 'Общие зарубежные туры'
  - `image_url` TEXT
  - `available` BOOLEAN DEFAULT 1

- `cruises`
  - `id` INTEGER PK AUTOINCREMENT
  - `name` TEXT NOT NULL
  - `description` TEXT
  - `price` REAL NOT NULL
  - `departure` TEXT
  - `duration` TEXT
  - `destination` TEXT
  - `category` TEXT DEFAULT 'Общие круизы'
  - `image_url` TEXT
  - `available` BOOLEAN DEFAULT 1

- `services`
  - `id` INTEGER PK AUTOINCREMENT
  - `name` TEXT NOT NULL
  - `description` TEXT
  - `price` REAL NOT NULL
  - `category` TEXT DEFAULT 'Общие услуги'
  - `image_url` TEXT
  - `available` BOOLEAN DEFAULT 1

- `promotions`
  - `id` INTEGER PK AUTOINCREMENT
  - `title` TEXT NOT NULL
  - `description` TEXT
  - `discount_percent` INTEGER
  - `valid_until` TEXT
  - `category` TEXT DEFAULT 'Общие акции'
  - `image_url` TEXT
  - `active` BOOLEAN DEFAULT 1

- `hero_backgrounds`
  - `id` INTEGER PK AUTOINCREMENT
  - `page_name` TEXT UNIQUE NOT NULL
  - `background_image_url` TEXT
  - `background_type` TEXT DEFAULT 'image'
  - `fallback_image_url` TEXT
  - `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP
  - `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP

- `bonus_history`
  - `id` INTEGER PK AUTOINCREMENT
  - `user_id` INTEGER NOT NULL REFERENCES `users(id)`
  - `points` INTEGER NOT NULL
  - `type` TEXT NOT NULL ('earned'|'spent')
  - `reason` TEXT
  - `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP

- `cart`
  - `id` INTEGER PK AUTOINCREMENT
  - `user_id` INTEGER NOT NULL
  - `item_id` INTEGER NOT NULL
  - `item_type` TEXT NOT NULL
  - `name` TEXT NOT NULL
  - `description` TEXT
  - `price` REAL NOT NULL
  - `quantity` INTEGER DEFAULT 1
  - `added_at` DATETIME DEFAULT CURRENT_TIMESTAMP
  - Optional metadata: `duration`, `destination`, `capacity`, `features` (JSON), `country`, `highlights` (JSON), `departure`, `category`

- `orders`
  - `id` INTEGER PK AUTOINCREMENT
  - `user_id` INTEGER NOT NULL
  - `total_amount` REAL NOT NULL
  - `status` TEXT DEFAULT 'pending'
  - `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP

- `order_items`
  - `id` INTEGER PK AUTOINCREMENT
  - `order_id` INTEGER NOT NULL REFERENCES `orders(id)`
  - `item_id` INTEGER NOT NULL
  - `item_type` TEXT NOT NULL
  - `quantity` INTEGER NOT NULL
  - `price` REAL NOT NULL

Note: Foreign keys are implied by code; SQLite PRAGMA not executed in this audit.

### Environment Variables & Secrets
- `PORT` (optional; default 5000)
- `JWT_SECRET`
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_CHAT_ID`

### Static Assets & Uploads
- Public assets: `public/` (favicon, logos, manifest, videos/*)
- Build artifacts: `build/` (mirrors public + compiled assets)
- Uploads served from: `server/uploads/*` via `/uploads/*`

### Tests
- Unit: `src/App.test.tsx` (default CRA test placeholder)
- Test libs: `@testing-library/react`, `@testing-library/jest-dom`, Jest config via CRA
- No MSW/e2e present yet

### Observations / Risks
- Mixed duplicate endpoints for foreign tours (`/api/foreign*` and `/api/foreign-tours*`)
- Admin login uses hardcoded credentials (should be replaced before prod)
- Local file uploads; no S3/minio abstraction yet
- JWT uses single token; no refresh rotation




